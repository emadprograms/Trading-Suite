#!/bin/bash

# Get the absolute path to the bundle's executable directory
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Calculate the project root (3 levels up from Contents/MacOS)
PROJECT_ROOT="$DIR/../../.."

# Navigate to project root
cd "$PROJECT_ROOT"

# Set Terminal Title
echo -n -e "\033]0;Trading Suite\007"

echo "=================================================="
echo "ğŸš€ Starting Trading Suite..."
echo "=================================================="
echo "ğŸ“‚ Project Root: $(pwd)"

# Helper: Check Python
check_python() {
    if command -v python3.12 &> /dev/null; then
        echo "âœ… Python 3.12 found."
        return 0
    else
        echo "âŒ Python 3.12 NOT found!"
        echo "   Please install it via: brew install python@3.12"
        osascript -e 'tell app "System Events" to display dialog "Python 3.12 is missing. Please install it." buttons "OK" default button "OK" with icon stop'
        exit 1
    fi
}

# Setup venv if missing
if [ ! -d "venv" ]; then
    echo "âš ï¸  Virtual environment not found. Creating one..."
    check_python
    python3.12 -m venv venv
    
    source venv/bin/activate
    echo "ğŸ“¦ Installing dependencies..."
    pip install --upgrade pip
    pip install -r requirements.txt
else
    source venv/bin/activate
fi

# Launch
echo "âœ… Environment Active."
echo "ğŸŒŸ Launching Home.py..."

# Run Streamlit
streamlit run Home.py

# Keep window open on exit/crash
read -p "Press Enter to close..."
